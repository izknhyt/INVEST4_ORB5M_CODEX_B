{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://invest3.example.com/schemas/observability_weekly_report.schema.json",
  "title": "WeeklyObservabilityReport",
  "type": "object",
  "required": [
    "schema_version",
    "generated_at",
    "week_start",
    "runs",
    "portfolio",
    "latency",
    "alerts",
    "sources"
  ],
  "properties": {
    "schema_version": {"type": "string"},
    "generated_at": {"type": "string", "format": "date-time"},
    "week_start": {"type": "string", "pattern": "^\\d{4}-\\d{2}-\\d{2}$"},
    "runs": {
      "type": "array",
      "items": {
        "type": "object",
        "required": [
          "run_id",
          "symbol",
          "mode",
          "timestamp",
          "trades",
          "wins",
          "total_pips",
          "win_rate"
        ],
        "properties": {
          "run_id": {"type": "string"},
          "symbol": {"type": "string"},
          "mode": {"type": "string"},
          "timestamp": {"type": "string", "format": "date-time"},
          "trades": {"type": "integer", "minimum": 0},
          "wins": {"type": "integer", "minimum": 0},
          "total_pips": {"type": "number"},
          "win_rate": {"type": "number"},
          "sharpe": {"type": "number"},
          "max_drawdown": {"type": "number"},
          "pnl_per_trade": {"type": "number"}
        },
        "additionalProperties": false
      }
    },
    "portfolio": {
      "type": "object",
      "required": ["budget_status"],
      "properties": {
        "budget_status": {"type": "string", "enum": ["ok", "warning", "breach"]},
        "category_utilisation": {
          "type": "array",
          "items": {
            "type": "object",
            "required": ["category", "budget_status"],
            "properties": {
              "category": {"type": "string"},
              "utilisation_pct": {"type": "number"},
              "budget_status": {"type": "string"},
              "headroom_pct": {"type": "number"}
            },
            "additionalProperties": true
          }
        },
        "gross_exposure_pct": {"type": "number"},
        "headroom_pct": {"type": "number"},
        "drawdown_pct": {"type": "number"},
        "generated_at": {"type": "string", "format": "date-time"}
      },
      "additionalProperties": true
    },
    "latency": {
      "type": "object",
      "required": ["p50_ms", "p95_ms", "p99_ms", "max_ms", "breach_count", "breaches", "samples"],
      "properties": {
        "p50_ms": {"type": "number", "minimum": 0},
        "p95_ms": {"type": "number", "minimum": 0},
        "p99_ms": {"type": "number", "minimum": 0},
        "max_ms": {"type": "number", "minimum": 0},
        "breach_count": {"type": "integer", "minimum": 0},
        "samples": {"type": "integer", "minimum": 0},
        "breaches": {
          "type": "array",
          "items": {
            "type": "object",
            "required": ["hour_utc", "p95_ms", "failure_rate", "count"],
            "properties": {
              "hour_utc": {"type": "string", "format": "date-time"},
              "p95_ms": {"type": "number"},
              "failure_rate": {"type": "number"},
              "count": {"type": "integer", "minimum": 0}
            },
            "additionalProperties": true
          }
        }
      },
      "additionalProperties": true
    },
    "alerts": {
      "type": "array",
      "items": {
        "type": "object",
        "required": ["id", "severity", "message", "evidence_path"],
        "properties": {
          "id": {"type": "string"},
          "severity": {"type": "string", "enum": ["info", "warning", "critical"]},
          "message": {"type": "string"},
          "evidence_path": {"type": "string"}
        },
        "additionalProperties": true
      }
    },
    "sources": {
      "type": "object",
      "additionalProperties": {"type": "string"}
    },
    "metadata": {
      "type": "object",
      "additionalProperties": true
    },
    "destinations": {
      "type": "object",
      "properties": {
        "webhooks": {
          "type": "array",
          "items": {"type": "string"}
        }
      },
      "additionalProperties": true
    }
  },
  "additionalProperties": true
}
