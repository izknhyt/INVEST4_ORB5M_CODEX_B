{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Day ORB experiment configuration",
  "type": "object",
  "required": [
    "name",
    "manifest_path",
    "runner",
    "search_space",
    "constraints",
    "seasonal_slices",
    "scoring"
  ],
  "additionalProperties": false,
  "properties": {
    "name": {"type": "string"},
    "summary": {"type": "string"},
    "manifest_path": {"type": "string"},
    "manifest_id": {"type": "string"},
    "mode": {"type": "string"},
    "base_output_dir": {"type": "string"},
    "runner": {
      "type": "object",
      "required": ["base_cli"],
      "additionalProperties": false,
      "properties": {
        "base_cli": {
          "type": "array",
          "items": {"type": "string"}
        },
        "equity": {"type": "number"},
        "use_years_from_data": {"type": "boolean"},
        "record_runtime": {"type": "boolean"}
      }
    },
    "search_space": {
      "type": "object",
      "additionalProperties": false,
      "patternProperties": {
        ".+": {
          "type": "object",
          "required": ["path", "type"],
          "properties": {
            "path": {"type": "string"},
            "type": {"type": "string", "enum": ["choice", "range", "float_range"]},
            "values": {
              "type": "array",
              "minItems": 1,
              "items": {}
            },
            "min": {"type": ["number", "integer"]},
            "max": {"type": ["number", "integer"]},
            "step": {"type": ["number", "integer"]},
            "precision": {"type": "integer", "minimum": 0}
          },
          "allOf": [
            {
              "if": {"properties": {"type": {"const": "choice"}}},
              "then": {"required": ["values"]}
            },
            {
              "if": {"properties": {"type": {"const": "range"}}},
              "then": {"required": ["min", "max"], "properties": {"min": {"type": "integer"}, "max": {"type": "integer"}, "step": {"type": "integer", "minimum": 1}}}
            },
            {
              "if": {"properties": {"type": {"const": "float_range"}}},
              "then": {
                "required": ["min", "max", "step"],
                "properties": {
                  "min": {"type": "number"},
                  "max": {"type": "number"},
                  "step": {"type": "number", "exclusiveMinimum": 0},
                  "precision": {"type": "integer", "minimum": 0}
                }
              }
            }
          ]
        }
      }
    },
    "constraints": {
      "type": "array",
      "items": {
        "type": "object",
        "required": ["id", "metric", "op", "threshold"],
        "additionalProperties": false,
        "properties": {
          "id": {"type": "string"},
          "metric": {"type": "string"},
          "op": {"type": "string", "enum": [">=", "<="]},
          "threshold": {"type": "number"},
          "description": {"type": "string"}
        }
      }
    },
    "seasonal_slices": {
      "type": "array",
      "minItems": 1,
      "items": {
        "type": "object",
        "required": ["id", "start", "end"],
        "additionalProperties": false,
        "properties": {
          "id": {"type": "string"},
          "start": {"type": "string", "format": "date"},
          "end": {"type": "string", "format": "date"}
        }
      }
    },
    "scoring": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "objectives": {
          "type": "array",
          "items": {
            "type": "object",
            "required": ["metric"],
            "additionalProperties": false,
            "properties": {
              "metric": {"type": "string"},
              "goal": {"type": "string", "enum": ["max", "min"]},
              "weight": {"type": "number"}
            }
          }
        },
        "penalties": {
          "type": "array",
          "items": {
            "type": "object",
            "required": ["metric"],
            "additionalProperties": false,
            "properties": {
              "metric": {"type": "string"},
              "goal": {"type": "string", "enum": ["max", "min"]},
              "weight": {"type": "number"}
            }
          }
        },
        "tie_breakers": {
          "type": "array",
          "items": {
            "type": "object",
            "required": ["metric"],
            "additionalProperties": false,
            "properties": {
              "metric": {"type": "string"},
              "goal": {"type": "string", "enum": ["max", "min"]},
              "weight": {"type": "number"}
            }
          }
        }
      }
    },
    "history": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "enabled": {"type": "boolean"},
        "notes": {"type": "string"}
      }
    },
    "notes": {
      "type": "array",
      "items": {"type": "string"}
    }
  }
}
