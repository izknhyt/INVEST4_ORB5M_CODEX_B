# yaml-language-server: $schema=../../schemas/day_orb_experiment.schema.json

name: Day ORB Core Sweep
summary: Parameter sweep configuration for the Day ORB 5m conservative baseline with risk and seasonal guardrails.
manifest_path: configs/strategies/day_orb_5m.yaml
manifest_id: day_orb_5m_v1
mode: conservative
base_output_dir: runs/sweeps/day_orb_core
runner:
  base_cli:
    - --csv
    - validated/USDJPY/5m.csv
    - --symbol
    - USDJPY
    - --mode
    - conservative
    - --no-auto-state
    - --debug
    - --debug-sample-limit
    - "250000"
  equity: 100000.0
  use_years_from_data: true
  record_runtime: true
portfolio:
  telemetry_path: reports/portfolio_samples/router_demo/telemetry.json
  strategies:
    - id: day_orb_5m_v1
      use_trial_manifest: true
      use_trial_metrics: true
      position: 1
    - id: tokyo_micro_mean_reversion_v0
      manifest_path: configs/strategies/tokyo_micro_mean_reversion.yaml
      metrics_path: reports/portfolio_samples/router_demo/metrics/tokyo_micro_mean_reversion_v0.json
      position: 2
  var:
    confidence: 0.95
  constraints:
    - id: portfolio_var_cap
      metric: portfolio.var.portfolio_pct
      op: "<="
      threshold: 0.04
      description: Portfolio 95% VaR must remain below 4% of equity
    - id: day_category_budget_ceiling
      metric: portfolio.state.category_budget_pct.day
      op: "<="
      threshold: 35.0
      description: Day category budget must stay within governance allocation
search_space:
  or_n:
    path: strategy.parameters.or_n
    type: choice
    values: [4, 5, 6, 7]
  k_tp:
    path: strategy.parameters.k_tp
    type: float_range
    min: 1.2
    max: 1.6
    step: 0.1
    precision: 2
  k_sl:
    path: strategy.parameters.k_sl
    type: float_range
    min: 0.6
    max: 1.0
    step: 0.1
    precision: 2
  k_tr:
    path: strategy.parameters.k_tr
    type: choice
    values: [0.2, 0.3, 0.4]
  min_or_atr_ratio:
    path: runner.runner_config.min_or_atr_ratio
    type: float_range
    min: 0.20
    max: 0.35
    step: 0.05
    precision: 3
  ny_high_rv_min_or_atr_ratio:
    path: runner.runner_config.ny_high_rv_min_or_atr_ratio
    type: float_range
    min: 0.30
    max: 0.40
    step: 0.05
    precision: 3
  require_close_breakout:
    path: strategy.parameters.require_close_breakout
    type: choice
    values: [false, true]
  cooldown_bars:
    path: strategy.parameters.cooldown_bars
    type: range
    min: 0
    max: 2
    step: 1
  retest_max_bars:
    path: strategy.parameters.retest_max_bars
    type: range
    min: 2
    max: 6
    step: 1
  max_loss_streak:
    path: strategy.parameters.max_loss_streak
    type: choice
    values: [3, 4, 5]
  max_daily_loss_pips:
    path: strategy.parameters.max_daily_loss_pips
    type: choice
    values: [100.0, 120.0, 150.0]
  max_daily_trade_count:
    path: strategy.parameters.max_daily_trade_count
    type: range
    min: 4
    max: 8
    step: 1
  fallback_win_rate:
    path: strategy.parameters.fallback_win_rate
    type: choice
    values: [0.50, 0.55, 0.60]
  min_atr_pips:
    path: strategy.parameters.min_atr_pips
    type: choice
    values: [0.0, 2.0, 4.0]
  max_atr_pips:
    path: strategy.parameters.max_atr_pips
    type: choice
    values: [30.0, 40.0, 50.0]
  min_micro_trend:
    path: strategy.parameters.min_micro_trend
    type: float_range
    min: 0.00
    max: 0.20
    step: 0.05
    precision: 2
  max_signals_per_day:
    path: strategy.parameters.max_signals_per_day
    type: range
    min: 2
    max: 6
    step: 1
  require_retest:
    path: strategy.parameters.require_retest
    type: choice
    values: [false, true]
  retest_tol_k:
    path: strategy.parameters.retest_tol_k
    type: float_range
    min: 0.15
    max: 0.30
    step: 0.05
    precision: 2
  allow_low_rv:
    path: runner.allow_low_rv
    type: choice
    values: [false, true]
  size_floor_mult:
    path: runner.size_floor_mult
    type: float_range
    min: 0.03
    max: 0.08
    step: 0.01
    precision: 3
constraints:
  - id: max_drawdown_limit
    metric: metrics.max_drawdown
    op: ">="
    threshold: -120.0
    description: Max drawdown (pips) must stay within the 120 pip guardrail.
  - id: sharpe_floor
    metric: metrics.sharpe
    op: ">="
    threshold: 0.20
    description: Overall Sharpe must be non-negative with margin for noise.
  - id: win_rate_floor
    metric: metrics.win_rate
    op: ">="
    threshold: 0.35
    description: Ensure win rate stays above the historical break-even band.
  - id: profit_factor_floor
    metric: metrics.profit_factor
    op: ">="
    threshold: 0.90
    description: Keep profit factor within acceptable drawdown risk tolerance.
  - id: trades_per_month_floor
    metric: metrics.trades_per_month
    op: ">="
    threshold: 18.0
    description: Average fills per month must sustain liquidity needs.
  - id: seasonal_2019_h1
    metric: seasonal.2019_h1.sharpe
    op: ">="
    threshold: -0.25
    description: Pre-COVID seasonality must remain stable.
  - id: seasonal_2019_h2
    metric: seasonal.2019_h2.sharpe
    op: ">="
    threshold: -0.25
  - id: seasonal_2020_q1
    metric: seasonal.2020_q1.sharpe
    op: ">="
    threshold: 0.0
  - id: seasonal_2020_q2
    metric: seasonal.2020_q2.sharpe
    op: ">="
    threshold: 0.0
  - id: seasonal_2021_h1
    metric: seasonal.2021_h1.sharpe
    op: ">="
    threshold: 0.0
  - id: seasonal_2021_h2
    metric: seasonal.2021_h2.sharpe
    op: ">="
    threshold: 0.0
  - id: seasonal_2022_h1
    metric: seasonal.2022_h1.sharpe
    op: ">="
    threshold: 0.0
  - id: seasonal_2022_h2
    metric: seasonal.2022_h2.sharpe
    op: ">="
    threshold: -0.10
  - id: seasonal_2023_h1
    metric: seasonal.2023_h1.sharpe
    op: ">="
    threshold: 0.0
  - id: seasonal_2023_h2
    metric: seasonal.2023_h2.sharpe
    op: ">="
    threshold: -0.10
  - id: seasonal_2024_h1
    metric: seasonal.2024_h1.sharpe
    op: ">="
    threshold: -0.05
  - id: seasonal_2024_h2
    metric: seasonal.2024_h2.sharpe
    op: ">="
    threshold: -0.05
  - id: seasonal_2025_ytd
    metric: seasonal.2025_ytd.sharpe
    op: ">="
    threshold: -0.10
seasonal_slices:
  - id: 2019_h1
    start: 2019-01-01
    end: 2019-06-30
  - id: 2019_h2
    start: 2019-07-01
    end: 2019-12-31
  - id: 2020_q1
    start: 2020-01-01
    end: 2020-03-31
  - id: 2020_q2
    start: 2020-04-01
    end: 2020-06-30
  - id: 2021_h1
    start: 2021-01-01
    end: 2021-06-30
  - id: 2021_h2
    start: 2021-07-01
    end: 2021-12-31
  - id: 2022_h1
    start: 2022-01-01
    end: 2022-06-30
  - id: 2022_h2
    start: 2022-07-01
    end: 2022-12-31
  - id: 2023_h1
    start: 2023-01-01
    end: 2023-06-30
  - id: 2023_h2
    start: 2023-07-01
    end: 2023-12-31
  - id: 2024_h1
    start: 2024-01-01
    end: 2024-06-30
  - id: 2024_h2
    start: 2024-07-01
    end: 2024-12-31
  - id: 2025_ytd
    start: 2025-01-01
    end: 2025-10-02
scoring:
  objectives:
    - metric: metrics.sharpe
      goal: max
      weight: 1.0
    - metric: metrics.total_pips
      goal: max
      weight: 0.01
    - metric: metrics.trades_per_month
      goal: max
      weight: 0.05
  penalties:
    - metric: metrics.max_drawdown
      goal: max
      weight: 0.5
    - metric: metrics.profit_factor
      goal: max
      weight: 0.2
  tie_breakers:
    - metric: metrics.max_drawdown
      goal: max
    - metric: metrics.win_rate
      goal: max
history:
  enabled: true
  notes: Append successful runs to experiments/history via log_experiment.
bayes:
  enabled: true
  seed: 20240731
  acquisition:
    name: expected_improvement
    parameters:
      xi: 0.015
  exploration_upper_bound: 120
  initial_random_trials: 16
  constraint_retry_limit: 2
  transforms:
    k_tp:
      mode: continuous
      transform: identity
    k_sl:
      mode: continuous
      transform: identity
    min_or_atr_ratio:
      mode: continuous
      transform: log
      bounds: [0.15, 0.40]
    ny_high_rv_min_or_atr_ratio:
      mode: continuous
      transform: log
      bounds: [0.25, 0.45]
    cooldown_bars:
      mode: discrete
      transform: identity
    max_loss_streak:
      mode: categorical
      transform: identity
